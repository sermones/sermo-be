# Sermo Backend - ê¸°ì—¬ ê°€ì´ë“œë¼ì¸

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

Sermo BackendëŠ” Go ì–¸ì–´ì™€ Fiber í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì¶•ëœ RESTful API ì„œë²„ì…ë‹ˆë‹¤. JWT ê¸°ë°˜ ì¸ì¦, PostgreSQL ë°ì´í„°ë² ì´ìŠ¤, ê·¸ë¦¬ê³  Swagger ë¬¸ì„œí™”ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

```
sermo-be/
â”œâ”€â”€ cmd/server/          # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”œâ”€â”€ internal/            # ë‚´ë¶€ íŒ¨í‚¤ì§€ (ë¹„ê³µê°œ)
â”‚   â”œâ”€â”€ config/         # ì„¤ì • ê´€ë¦¬
â”‚   â”œâ”€â”€ handlers/       # HTTP ìš”ì²­ í•¸ë“¤ëŸ¬
â”‚   â”œâ”€â”€ middleware/     # ë¯¸ë“¤ì›¨ì–´
â”‚   â”œâ”€â”€ models/         # ë°ì´í„° ëª¨ë¸
â”‚   â””â”€â”€ routes/         # ë¼ìš°íŒ… ì„¤ì •
â”œâ”€â”€ pkg/                # ê³µê°œ íŒ¨í‚¤ì§€
â”‚   â”œâ”€â”€ database/       # ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë° ê´€ë¦¬
â”‚   â”œâ”€â”€ jwt/            # JWT í† í° ê´€ë¦¬
â”‚   â”œâ”€â”€ r2/             # Cloudflare R2 ìŠ¤í† ë¦¬ì§€ (ì¤€ë¹„ ì¤‘)
â”‚   â”œâ”€â”€ logger/         # ë¡œê¹… (ì¤€ë¹„ ì¤‘)
â”‚   â””â”€â”€ utils/          # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ì¤€ë¹„ ì¤‘)
â””â”€â”€ docs/               # Swagger API ë¬¸ì„œ
```

## ğŸ“¦ íŒ¨í‚¤ì§€ êµ¬ì¡° ìƒì„¸ ë¶„ì„

### 1. cmd/server/
- **main.go**: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì§„ì…ì 
  - ì„¤ì • ë¡œë“œ
  - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
  - ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
  - ë¼ìš°í„° ì„¤ì •
  - Graceful shutdown ì²˜ë¦¬

### 2. internal/config/
- **config.go**: í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì • ê´€ë¦¬
  - ì„œë²„ ì„¤ì • (í˜¸ìŠ¤íŠ¸, í¬íŠ¸)
  - ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (PostgreSQL)
  - R2 ì„¤ì • (Cloudflare R2 ìŠ¤í† ë¦¬ì§€)

### 3. internal/models/
- **user.go**: ì‚¬ìš©ì ë°ì´í„° ëª¨ë¸
  - UUID ê¸°ë°˜ ID
  - ì‚¬ìš©ìëª…, ì´ë¦„, ë¹„ë°€ë²ˆí˜¸
  - ìƒì„±/ìˆ˜ì • ì‹œê°„ ìë™ ê´€ë¦¬

### 4. internal/handlers/
#### auth/
- **signup_handler.go**: íšŒì›ê°€ì… ì²˜ë¦¬
- **login_handler.go**: ë¡œê·¸ì¸ ì²˜ë¦¬

#### user/
- **profile_handler.go**: ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ

### 5. internal/middleware/
- **auth_middleware.go**: JWT í† í° ê²€ì¦
- **database_middleware.go**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì£¼ì…
- **config_middleware.go**: ì„¤ì • ì£¼ì…

### 6. internal/routes/
- **routes.go**: ë©”ì¸ ë¼ìš°í„° ì„¤ì •
- **auth_routes.go**: ì¸ì¦ ê´€ë ¨ ë¼ìš°íŠ¸
- **user_routes.go**: ì‚¬ìš©ì ê´€ë ¨ ë¼ìš°íŠ¸
- **health_routes.go**: í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
- **swagger_routes.go**: Swagger UI ë¼ìš°íŠ¸

### 7. pkg/
- **database/**: PostgreSQL ì—°ê²° ë° GORM ì„¤ì •
- **jwt/**: JWT í† í° ìƒì„± ë° ê²€ì¦
- **r2/**: Cloudflare R2 ìŠ¤í† ë¦¬ì§€ (ì¤€ë¹„ ì¤‘)
- **logger/**: ë¡œê¹… ì‹œìŠ¤í…œ (ì¤€ë¹„ ì¤‘)
- **utils/**: ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ì¤€ë¹„ ì¤‘)

## ğŸ”„ Request/Response DTO êµ¬ì¡°

### ì¸ì¦ ê´€ë ¨ DTO

#### SignUpRequest
```go
type SignUpRequest struct {
    Nickname string `json:"nickname"` // 3-20ì
    Name     string `json:"name"`     // 1-100ì
    Password string `json:"password"` // ìµœì†Œ 6ì
}
```

#### SignUpResponse
```go
type SignUpResponse struct {
    Message string `json:"message"`
    UserID  string `json:"user_id"`
}
```

#### LoginRequest
```go
type LoginRequest struct {
    ID       string `json:"id"`
    Password string `json:"password"`
}
```

#### LoginResponse
```go
type LoginResponse struct {
    Token string `json:"token"`
    User  struct {
        ID       string `json:"id"`
        Username string `json:"username"`
    } `json:"user"`
}
```

### ì‚¬ìš©ì ê´€ë ¨ DTO

#### ProfileResponse
```go
type ProfileResponse struct {
    UUID      string `json:"uuid"`
    ID        string `json:"id"`
    Nickname  string `json:"nickname"`
    CreatedAt string `json:"created_at"`
}
```

## ğŸ” ë¯¸ë“¤ì›¨ì–´ êµ¬ì¡° ë° ë™ì‘ ë°©ì‹

### 1. ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ (AuthMiddleware)
- **ìœ„ì¹˜**: `internal/middleware/auth_middleware.go`
- **ê¸°ëŠ¥**: JWT í† í° ê²€ì¦ ë° ì‚¬ìš©ì ID ì¶”ì¶œ
- **ë™ì‘ ìˆœì„œ**:
  1. Authorization í—¤ë”ì—ì„œ Bearer í† í° ì¶”ì¶œ
  2. JWT í† í° ê²€ì¦
  3. ì‚¬ìš©ì IDë¥¼ contextì— ì €ì¥
  4. ë‹¤ìŒ í•¸ë“¤ëŸ¬ë¡œ ì§„í–‰

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë¯¸ë“¤ì›¨ì–´ (DatabaseMiddleware)
- **ìœ„ì¹˜**: `internal/middleware/database_middleware.go`
- **ê¸°ëŠ¥**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ contextì— ì£¼ì…
- **ì‚¬ìš©ë²•**: `middleware.GetDB(c)`ë¡œ í•¸ë“¤ëŸ¬ì—ì„œ ì ‘ê·¼

### 3. ì„¤ì • ë¯¸ë“¤ì›¨ì–´ (ConfigMiddleware)
- **ìœ„ì¹˜**: `internal/middleware/config_middleware.go`
- **ê¸°ëŠ¥**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •ì„ contextì— ì£¼ì…
- **ì‚¬ìš©ë²•**: `middleware.GetConfig(c)`ë¡œ í•¸ë“¤ëŸ¬ì—ì„œ ì ‘ê·¼

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ ë° ìŠ¤í‚¤ë§ˆ

### User ëª¨ë¸
```go
type User struct {
    UUID      uuid.UUID `json:"uuid" gorm:"type:uuid;primary_key;default:gen_random_uuid()"`
    ID        string    `json:"id" gorm:"type:varchar(20);uniqueIndex;not null"`
    Nickname  string    `json:"nickname" gorm:"type:varchar(100);not null"`
    Password  string    `json:"-" gorm:"type:varchar(255);not null"`
    CreatedAt time.Time `json:"created_at" gorm:"autoCreateTime"`
    UpdatedAt time.Time `json:"updated_at" gorm:"autoUpdateTime"`
}
```

### ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
- **ë“œë¼ì´ë²„**: PostgreSQL (GORM)
- **ì—°ê²° í’€**: ìµœëŒ€ 100ê°œ ì—°ê²°, ìµœëŒ€ 10ê°œ ìœ íœ´ ì—°ê²°
- **íƒ€ì„ì¡´**: Asia/Seoul
- **ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜**: í™œì„±í™”

## ğŸ›£ï¸ ë¼ìš°íŒ… êµ¬ì¡° ë° API ì—”ë“œí¬ì¸íŠ¸

### ê³µê°œ ì—”ë“œí¬ì¸íŠ¸
- `GET /health` - ì„œë²„ ìƒíƒœ í™•ì¸
- `GET /swagger/*` - Swagger UI
- `POST /auth/signup` - íšŒì›ê°€ì…
- `POST /auth/login` - ë¡œê·¸ì¸

### ì¸ì¦ í•„ìš” ì—”ë“œí¬ì¸íŠ¸
- `GET /user/profile` - ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ

### ë¼ìš°í„° ê·¸ë£¹ êµ¬ì¡°
```go
// ì¸ì¦ ë¼ìš°í„° ê·¸ë£¹
authGroup := app.Group("/auth")
authGroup.Post("/signup", auth.SignUp)
authGroup.Post("/login", auth.Login)

// ì‚¬ìš©ì ë¼ìš°í„° ê·¸ë£¹ (ì¸ì¦ í•„ìš”)
userGroup := app.Group("/user", middleware.AuthMiddleware())
userGroup.Get("/profile", user.GetProfile)
```

## ğŸ“š ì˜ì¡´ì„± ë° ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬

### í•µì‹¬ í”„ë ˆì„ì›Œí¬
- **Fiber v2**: ê³ ì„±ëŠ¥ HTTP í”„ë ˆì„ì›Œí¬
- **GORM v1**: ORM ë¼ì´ë¸ŒëŸ¬ë¦¬
- **PostgreSQL**: ë°ì´í„°ë² ì´ìŠ¤

### ì¸ì¦ ë° ë³´ì•ˆ
- **JWT v5**: JSON Web Token
- **UUID**: ê³ ìœ  ì‹ë³„ì ìƒì„±

### ë¬¸ì„œí™”
- **Swagger**: API ë¬¸ì„œ ìë™ ìƒì„±

### ê°œë°œ ë„êµ¬
- **CORS**: í¬ë¡œìŠ¤ ì˜¤ë¦¬ì§„ ë¦¬ì†ŒìŠ¤ ê³µìœ 
- **Logger**: HTTP ìš”ì²­ ë¡œê¹…
- **Recover**: íŒ¨ë‹‰ ë³µêµ¬

## ğŸš€ ê°œë°œ ê°€ì´ë“œë¼ì¸

### 1. ì½”ë“œ êµ¬ì¡° ê·œì¹™
- **íŒ¨í‚¤ì§€ëª…**: ì†Œë¬¸ì, ë‹¨ì¼ ë‹¨ì–´
- **íŒŒì¼ëª…**: snake_case
- **í•¨ìˆ˜ëª…**: PascalCase (ê³µê°œ), camelCase (ë¹„ê³µê°œ)
- **ë³€ìˆ˜ëª…**: camelCase

### 2. í•¸ë“¤ëŸ¬ ì‘ì„± ê·œì¹™
```go
// 1. DTO ì •ì˜ (Request/Response)
type ExampleRequest struct {
    Field string `json:"field"`
}

// 2. Swagger ì£¼ì„ ì‘ì„±
// @Summary ìš”ì•½
// @Description ìƒì„¸ ì„¤ëª…
// @Tags íƒœê·¸
// @Accept json
// @Produce json
// @Param request body ExampleRequest true "ìš”ì²­ ë°ì´í„°"
// @Success 200 {object} ExampleResponse
// @Failure 400 {object} map[string]interface{}
// @Router /path [method]

// 3. í•¸ë“¤ëŸ¬ í•¨ìˆ˜ êµ¬í˜„
func ExampleHandler(c *fiber.Ctx) error {
    // ìš”ì²­ íŒŒì‹±
    var req ExampleRequest
    if err := c.BodyParser(&req); err != nil {
        return c.Status(400).JSON(fiber.Map{"error": "Invalid request"})
    }
    
    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    
    // ì‘ë‹µ ë°˜í™˜
    return c.JSON(response)
}
```

### 3. ë¯¸ë“¤ì›¨ì–´ ì‘ì„± ê·œì¹™
```go
func ExampleMiddleware() fiber.Handler {
    return func(c *fiber.Ctx) error {
        // ì „ì²˜ë¦¬ ë¡œì§
        
        // ë‹¤ìŒ í•¸ë“¤ëŸ¬ í˜¸ì¶œ
        if err := c.Next(); err != nil {
            return err
        }
        
        // í›„ì²˜ë¦¬ ë¡œì§
        return nil
    }
}
```

### 4. ì—ëŸ¬ ì²˜ë¦¬ ê·œì¹™
- HTTP ìƒíƒœ ì½”ë“œ ì ì ˆíˆ ì‚¬ìš©
- ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
- ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ê³ ë ¤

### 5. ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© ê·œì¹™
- **ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬**: `database.RunMigrations()` í•¨ìˆ˜ë¡œ ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬
- íŠ¸ëœì­ì…˜ ì ì ˆíˆ ì‚¬ìš©
- N+1 ì¿¼ë¦¬ ë¬¸ì œ ë°©ì§€
- **ëª¨ë¸ ìƒì„± ì‹œ ë°˜ë“œì‹œ New í•¨ìˆ˜ ì‚¬ìš©**: `models.NewUser()`, `models.NewImage()` ë“±

### 6. ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬
- **ìë™ ì‹¤í–‰**: ì„œë²„ ì‹œì‘ ì‹œ `database.RunMigrations()` ìë™ ì‹¤í–‰
- **ìˆ˜ë™ ì‹¤í–‰**: `make migrate` ëª…ë ¹ì–´ë¡œ ë³„ë„ ì‹¤í–‰ ê°€ëŠ¥
- **ëª¨ë¸ ì¶”ê°€**: ìƒˆë¡œìš´ ëª¨ë¸ì€ `pkg/database/database.go`ì˜ `RunMigrations()` í•¨ìˆ˜ì— ì¶”ê°€

## ğŸ”§ ê°œë°œ í™˜ê²½ ì„¤ì •

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
- Go 1.25.0 ì´ìƒ
- PostgreSQL 12 ì´ìƒ
- Make (ì„ íƒì‚¬í•­)

### í™˜ê²½ë³€ìˆ˜ ì„¤ì •
```bash
# ì„œë²„ ì„¤ì •
PORT=3000
HOST=0.0.0.0

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=password
DB_NAME=sermo
DB_SSLMODE=disable



# R2 ì„¤ì • (ì¤€ë¹„ ì¤‘)
R2_ACCESS_KEY_ID=your_access_key
R2_SECRET_ACCESS_KEY=your_secret_key
R2_ENDPOINT=your_endpoint
R2_BUCKET=your_bucket
```

### ì‹¤í–‰ ë°©ë²•
```bash
# ê°œë°œ ëª¨ë“œ
go run cmd/server/main.go

# ë¹Œë“œ í›„ ì‹¤í–‰
go build -o bin/server cmd/server/main.go
./bin/server
```

## ğŸ“ ê¸°ì—¬ í”„ë¡œì„¸ìŠ¤

1. **ì´ìŠˆ ìƒì„±**: ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ë‚˜ ë²„ê·¸ ìˆ˜ì • ìš”ì²­
2. **ë¸Œëœì¹˜ ìƒì„±**: `feature/ê¸°ëŠ¥ëª…` ë˜ëŠ” `fix/ë²„ê·¸ëª…` í˜•ì‹
3. **ì½”ë“œ ì‘ì„±**: ìœ„ì˜ ê°€ì´ë“œë¼ì¸ ì¤€ìˆ˜
4. **í…ŒìŠ¤íŠ¸**: ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ê¸°ì¡´ ê¸°ëŠ¥ ì˜í–¥ í™•ì¸
5. **Pull Request**: ìƒì„¸í•œ ì„¤ëª…ê³¼ í•¨ê»˜ PR ìƒì„±
6. **ì½”ë“œ ë¦¬ë·°**: íŒ€ì›ë“¤ì˜ ë¦¬ë·° ë° í”¼ë“œë°± ë°˜ì˜
7. **ë¨¸ì§€**: ìŠ¹ì¸ í›„ main ë¸Œëœì¹˜ë¡œ ë¨¸ì§€

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œë¼ì¸

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë³„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- ëª¨ë¸ í•¨ìˆ˜ë³„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë³„ í…ŒìŠ¤íŠ¸ ì‘ì„±

### í†µí•© í…ŒìŠ¤íŠ¸
- API ì—”ë“œí¬ì¸íŠ¸ë³„ í…ŒìŠ¤íŠ¸
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ í…ŒìŠ¤íŠ¸
- ë¯¸ë“¤ì›¨ì–´ ë™ì‘ í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸
go test ./...

# íŠ¹ì • íŒ¨í‚¤ì§€ í…ŒìŠ¤íŠ¸
go test ./internal/handlers/auth

# í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
go test -cover ./...
```

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [Fiber ê³µì‹ ë¬¸ì„œ](https://docs.gofiber.io/)
- [GORM ê³µì‹ ë¬¸ì„œ](https://gorm.io/docs/)
- [JWT ê³µì‹ ë¬¸ì„œ](https://jwt.io/)
- [Swagger ê³µì‹ ë¬¸ì„œ](https://swagger.io/docs/)

---

**ì°¸ê³ **: ì´ ë¬¸ì„œëŠ” í”„ë¡œì íŠ¸ì˜ í˜„ì¬ ìƒíƒœë¥¼ ë°˜ì˜í•˜ë©°, í”„ë¡œì íŠ¸ ë°œì „ì— ë”°ë¼ ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
